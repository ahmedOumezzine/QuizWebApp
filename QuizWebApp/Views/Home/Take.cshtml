@model IEnumerable<QuizWebApp.Models.Question>

@{
    ViewBag.Title = "Take";
}

@foreach (var item in Model)
{

    <div class="col-sm-12">
        @item.QuestionDescription <br />
        @if (item.QuestionType == QuizWebApp.Models.QuestionType.FillInBlank)
        {
            <br />
            string razorCode = item.FillInBlank;
            string newRazorCode = "";
            int count = 0;
            int question = 0;

            for (int i = 0; i < razorCode.Length; i++)
            {
                if (razorCode[i] == '{')
                {
                    count++;
                    newRazorCode += "<select name=\"cars\" id=\"cars\">";
                }
                else if (razorCode[i] == '}')
                {
                    count--;
                    newRazorCode += "}";
                }
                else
                {
                    newRazorCode += razorCode[i];
                }

                if (count == 0 && newRazorCode.EndsWith("}"))
                {
                    foreach (var Choice in item.Choices.Where(x=>x.GroupBy== "question_"+ question))
                    {
                        newRazorCode += "<option value= '" + @Choice.Id+ "'   > " + Choice.ChoiceText + "</option>";
                    }
                    newRazorCode += "</select>";
                    question++;

                }
            }

            @Html.Raw(newRazorCode)

        }
        @if (item.QuestionType == QuizWebApp.Models.QuestionType.SingleChoice || item.QuestionType == QuizWebApp.Models.QuestionType.TrueFalse)
        {
            foreach (var Choice in item.Choices)
            {
                <input type="radio" id="Choice_@Choice.Id" name="reponse" value="@Choice.Id">
                <label for="Choice_@Choice.Id">@Choice.ChoiceText</label>
                <br />
            }
            <hr />
        }
        @if (item.QuestionType == QuizWebApp.Models.QuestionType.MultiChoice)
        {
            foreach (var Choice in item.Choices)
            {
                <input type="checkbox" id="Choice_@Choice.Id" name="reponse" value="@Choice.Id">
                <label for="Choice_@Choice.Id">@Choice.ChoiceText</label>
                <br />
            }
            <hr />
        }

        @if (item.QuestionType == QuizWebApp.Models.QuestionType.DragAndDrop || item.QuestionType == QuizWebApp.Models.QuestionType.DragAndDrop2)
        {

            <div class="facet-container row">
                <div class="left">
                    <label>All options</label>
                    <ul id="allFacets" class="facet-list">
                        @{
                            var rnd = new Random();
                        }

                        @foreach (var Choice in item.Choices.OrderBy(i => rnd.Next()).ToList())
                        {
                            <li class="facet" value="@Choice.Id">@Choice.ChoiceText</li>

                        }
                    </ul>
                </div>
                <div class="right">
                    <label>Your reponse</label>
                    <ul id="userFacets" class="facet-list">
                    </ul>
                </div>
            </div>
            <hr />
        }
    </div>
}
@section Styles {

    <style>
        .facet-container {
            width: 330px;
        } 

        .facet-list {
            list-style-type: none;
            margin: 0;
            padding: 0;
            margin-right: 10px;
            background: #eee;
            padding: 5px;
            width: 143px;
            min-height: 1.5em;
            font-size: 0.85em;
        }

            .facet-list li {
                margin: 5px;
                padding: 5px;
                font-size: 1.2em;
                width: 120px;
            }

                .facet-list li.placeholder {
                    height: 1.2em
                }

        .facet {
            border: 1px solid #bbb;
            background-color: #fafafa;
            cursor: move;
        }

            .facet.ui-sortable-helper {
                opacity: 0.5;
            }

        .placeholder {
            border: 1px solid orange;
            background-color: #fffffd;
        }
    </style>
}
@section Scripts {
    <script>
        $(function () {
            $("#allFacets, #userFacets").sortable({
                connectWith: "ul",
                placeholder: "placeholder",
                delay: 150
            })
                .disableSelection()
                .dblclick(function (e) {
                    var item = e.target;
                    if (e.currentTarget.id === 'allFacets') {
                        //move from all to user
                        $(item).fadeOut('fast', function () {
                            $(item).appendTo($('#userFacets')).fadeIn('slow');
                        });
                    } else {
                        //move from user to all
                        $(item).fadeOut('fast', function () {
                            $(item).appendTo($('#allFacets')).fadeIn('slow');
                        });
                    }
                });
        });
    </script>
}